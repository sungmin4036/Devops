코드를 배포하는데에는 무중단/중단 배포, In-place 배포, blue/green 배포등이 있습니다.

ㅁ 무중단/중단 배포

게임을 하다 보면 "서버 정기 점검"을 겪어보셨을 겁니다. 대표적인 중단 배포라고 할 수 있는데, 무중단 배포를 하게 되면 새로운 버전으로 들어온 유저와 기존 버전의 유저들 사이에 정책이 달라서 서비스를 제공할 수 없기 때문입니다.

A,B라는 두 기능을 제공하는 서비스에서 C라는 새로운 기능을 제공하려고 할 때, C 기능이 A,B에 영향을 주지 않는다면 무중단 배포를 해도 지장이 없습니다.

이처럼 무중단 배포는 down time을 최소화 할 수 있지만 중단 배포에 비해 비용이 크게 발생하는 경우가 생길 수 있습니다.

<br> 
<br> 

ㅁ In-place 배포

무중단 배포를 하기 위한 방법중 하나로, 여러 대의 서버를 배포할 때 새롭게 서버를 생성하거나 줄이지 않고 배포를 하는 방법입니다.

간략히 말하면, 1~4번 서버가 현재 서비스를 제공하고 있고 새로운 버전으로 업데이트를 진행한다고 생각하겠습니다.

이제 1,2서버는 중지를 시키고 3,4 서버만 사용하여 서비스를 진행합니다. 그리고 1,2 서버의 버전을 업그레이드하고 1,2 서버에 서비스를 연결, 3,4서버는 중지를 합니다.

이제 3,4 서버를 업그레이드하고 다시 서비스를 연결하면 배포가 완료되는 방식입니다.


<br>
<br>


ㅁ blue/green

: blue/green 배포는 In-place 배포와 마찬가지로 무중단 배포 기법 중 하나입니다.

blue group이 서비스를 제공하는 동안, 기존 AMI이미지의 모태인 인스턴스에서 업그레이드를 진행합니다.

그 후 새로 AMI를 만들고 green group이 서비스를 제공하도록 한다음, blue group을 내리면 됩니다.

Auto Scaling group으로 여러대의 인스턴스를 사용하는 경우 위와 같은 blue/green 배포를 사용하지만, Auto Scaling group이 없이 적은수의 서버를 운영하는 경우

nginx와 같은 서버 내의 웹 서버를 이용해 blue/green 배포를 진행할 수 있습니다.

이는 nginx에서 서비스 자체를 재시작하는 restart 명령어와 설정 파일을 리로드하는 reload 명령어가 있기에 가능합니다. 

restart는 nginx 서비스를 종료하고 다시 실행하기 때문에 해당 시간동안 들어온 요청이나 처리중이던 작업은 에러가 납니다.

reload는 nginx에서 새로운 프로세스를 생성하고 기존 프로세스에는 새로운 요청을 받지 않도록 처리합니다. 그리고 기존에 처리중이던 요청이 모두 종료될 때까지 기다리기 때문에 에러없이 새로운 설정을 적용할 수 있습니다.

![image](https://user-images.githubusercontent.com/62640332/155846142-c9c87680-1707-4e0f-bebb-60a078c3bcd0.png)