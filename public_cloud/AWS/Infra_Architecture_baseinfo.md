- [3 계층 아키텍처 개요](#3-계층-아키텍처-개요)
  
- [API Gateway](#api-gateway)

- [Amazon CloudWatch](#amazon-cloudwatch)

- [API 인증](#api-인증)

- [Amazon CloudFront](#amazon-cloudfront)

- [액세스 제한](#액세스-제한)

- [서버리스 데이터 스토리지 옵션](#서버리스-데이터-스토리지-옵션)

- [비 서버리스 데이터 스토리지 옵션](#비-서버리스-데이터-스토리지-옵션)

- [프리젠테이션 계층](#프리젠테이션-계층)

- [웹 서비스 계층 구성](#웹-서비스-계층-구성)

- [AWS VPC](#AWS-VPC)
  
<br>
<br>

---



#### 3 계층 아키텍처 개요
3 계층 아키텍처는 가장 많이 사용되는 멀티 계층 아키텍처이며 단일 프레젠테이션 계층, 논리 계층 및 데이터 계층으로 구성됩니다. 그림 1은 단순하고 일반적인 3 계층 응용 프로그램의 예를 보여줍니다.

![image](https://user-images.githubusercontent.com/62640332/156174455-bb6c2cc0-2b35-4077-b711-b097e975c824.png)

일반적인 3 계층 아키텍처 패턴에 대해 자세히 배울 수 있는 많은 유용한 자료가 온라인에 있습니다. 이 백서는 Amazon API Gateway 및 AWS Lambda를 사용하는 이 아키텍처의 특정 구현 패턴에 중점을 둡니다.

ㅁAWS Lambda:

- 선택, 보안, 패치 또는 관리 할 운영 체제가 없습니다.
- 적절한 크기, 모니터링 또는 확장 서버가 없습니다.
- 초과 프로비저닝으로 인한 비용 위험 감소
- 언더 프로비저닝으로 인한 성능 위험 감소

ㅁ Amazon API Gateway:

- API 배포, 모니터링 및 보안을 위한 단순화 된 메커니즘.
- 캐싱 및 컨텐츠 전달을 통한 API 성능 향상


#### API Gateway
Amazon API Gateway REST API는 리소스와 메소드로 구성됩니다. 

리소스는 앱이 리소스 경로 (예 : / tickets)를 통해 액세스 할 수있는 논리적 개체입니다. 

메소드는 API 리소스 (예 : GET / 티켓)에 제출 된 REST API 요청에 해당합니다. 

API Gateway를 사용하면 Lambda 함수를 사용하여 각 메소드를 백업 할 수 있습니다. 

즉, API Gateway에 노출 된 HTTPS 엔드 포인트를 통해 API를 호출하면 API Gateway가 Lambda 함수를 호출합니다.

프록시 통합 및 비 프록시 통합을 사용하여 API Gateway 및 Lambda 기능을 연결할 수 있습니다.

<br>
<br>

#### Amazon CloudWatch

Amazon API Gateway는 Amazon CloudWatch와 완벽하게 통합되어 API Gateway에서 원시 데이터를 수집하여 API 실행 모니터링을 위한 거의 실시간으로 읽을 수 있는 실시간 지표로 처리합니다. 

API Gateway는 구성 가능한 보고서 및 디버깅을 위한 AWS X-Ray 추적을 통한 액세스 로깅도 지원합니다. 

이러한 각 기능을 작성하려면 코드를 작성하지 않아도 되며 핵심 비즈니스 로직에 대한 위험 없이 프로덕션 환경에서 실행되는 응용 프로그램에서 조정할 수 있습니다.

<br>
<br>

#### API 인증

API의 일부로 생성 한 각 리소스 / 메소드 조합에는 AWS IAM 정책에서 참조 할 수 있는 고유한 특정 Amazon 리소스 이름 (ARN)이 부여됩니다.
Amazon API Gateway에서 API에 권한을 추가하는 일반적인 방법에는 세 가지가 있습니다.

- IAM 역할 및 정책 : 클라이언트는 API 액세스에 AWS Signature Version 4 (SigV4) 권한 부여 및 IAM 정책을 사용합니다. 

동일한 자격 증명으로 필요에 따라 다른 AWS 서비스 및 리소스 (예 : Amazon S3 버킷 또는 Amazon DynamoDB 테이블)에 대한 액세스를 제한하거나 허용 할 수 있습니다.

- Amazon Cognito 사용자 풀 : 클라이언트는 Amazon Cognito 사용자 풀을 통해 로그인하고 요청의 Authorization 헤더에 포함 된 토큰을 얻습니다.

- Custom Authorizer: 베어러 토큰 전략 (예 : OAuth, SAML)을 사용하거나 요청 매개 변수를 사용하여 사용자를 식별하는 사용자 정의 권한 부여 체계를 구현하는 Lambda 함수를 정의하십시오.

<br>
<br>

#### Amazon CloudFront

각 Amazon API Gateway 배포에는 기본적으로 Amazon CloudFront 배포가 포함됩니다. 

`Amazon CloudFront`는 Amazon의 엣지 로케이션 네트워크를 API를 사용하는 클라이언트의 연결 지점으로 사용하는 콘텐츠 전송 서비스입니다. 

이를 통해 API의 응답 대기 시간을 줄일 수 있습니다. 

Amazon CloudFront는 전 세계에서 여러 개의 엣지 로케이션을 사용하여 DDoS (분산 서비스 거부) 공격 시나리오에 대처할 수 있는 기능도 제공합니다. 

자세한 내용은 DDoS 탄력성에 대한 AWS 모범 사례 백서를 참조하십시오.

Amazon API Gateway를 사용하여 선택적인 메모리 캐시에 응답을 저장하여 특정 API 요청의 성능을 향상시킬 수 있습니다. 

이 방법은 반복 API 요청에 대한 성능 이점을 제공 할뿐만 아니라 Lambda 함수 실행 횟수를 줄여 전체 비용을 줄일 수 있습니다.

<br>
<br>

#### 액세스 제한
Amazon API Gateway는 API 키 생성 및 이러한 키와 구성 가능한 사용 계획의 연관을 지원합니다. 

Amazon CloudWatch로 API 키 사용을 모니터링 할 수 있습니다.

API Gateway는 API의 각 메서드에 대한 제한, 속도 제한 및 버스트 속도 제한을 지원합니다.

Amazon API Gateway와 함께 AWS WAF (Web Application Firewall)를 사용하여 API를 공격으로부터 보호 할 수 있습니다.

#### 서버리스 데이터 스토리지 옵션

- Amazon S3는 업계 최고의 확장성, 데이터 가용성, 보안 및 성능을 제공하는 객체 스토리지 서비스입니다.
  
- Amazon Aurora는 클라우드용으로 구축 된 MySQL 및 PostgreSQL 호환 관계형 데이터베이스로, 기존 엔터프라이즈 데이터베이스의 성능과 가용성을 오픈 소스 데이터베이스의 단순성과 비용 효율성과 결합합니다.      Amazon Aurora는 서버리스 및 기존 사용 모델을 모두 제공합니다.

- Amazon DynamoDB는 모든 규모에서 한 자리 밀리 초 성능을 제공하는 키-값 및 문서 데이터베이스입니다. 
  
내장 된 보안, 백업 및 복원, 인터넷 규모의 애플리케이션을위한 인 메모리 캐싱 기능을 갖춘 완전 관리형 서버리스 멀티 리전 멀티 마스터 내구성 데이터베이스입니다.

- Amazon Timestream은 IoT 및 운영 애플리케이션을 위한 빠르고 확장 가능하며 완벽하게 관리되는 시계열 데이터베이스 서비스로 관계형 데이터베이스 비용의 1/10에 하루에 수조 건의 이벤트를 쉽게 저장하고 분석 할 수 있습니다.

IoT 장치, IT 시스템 및 스마트 산업 기계의 증가에 따라 시간이 지남에 따라 변화하는 방식을 측정하는 데이터 인 시계열 데이터는 가장 빠르게 성장하는 데이터 유형 중 하나입니다.

- Amazon QLDB (Amazon Quantum Ledger Database)는 중앙에서 신뢰할 수 있는 기관이 소유한 투명하고 불변의 암호로 확인할 수 있는 트랜잭션 로그를 제공하는 완전 관리형 원장 데이터베이스입니다.

Amazon QLDB는 모든 애플리케이션 데이터 변경 사항을 추적하고 시간이 지남에 따라 완전하고 검증 가능한 변경 기록을 유지합니다.

#### 비 서버리스 데이터 스토리지 옵션

- Amazon Relational Database Service (Amazon RDS)는 사용 가능한 엔진 (Amazon Aurora, PostgreSQL, MySQL, MariaDB, Oracle 및 SQL Server)을 사용하여 관계형 데이터베이스를 보다 쉽게 설정, 운영 및 확장 할 수 있는 관리 형 웹 서비스입니다.
  
메모리, 성능 또는 I / O에 최적화 된 여러 다른 데이터베이스 인스턴스 유형에서 실행됩니다.

- Amazon Redshift는 클라우드에서 완벽하게 관리되는 페타 바이트 규모의 데이터웨어 하우스 서비스입니다.

- Amazon ElastiCache는 Redis 또는 Memcached의 완전 관리형 배포입니다. 널리 사용되는 오픈 소스 호환인 메모리 데이터 저장소를 원활하게 배포, 실행 및 확장 할 수 있습니다.

- Amazon Neptune은 빠르고 안정적인 완전 관리형 그래프 데이터베이스 서비스로, 고도로 연결된 데이터 세트와 함께 작동하는 애플리케이션을 쉽게 구축하고 실행할 수 있습니다.

- Amazon Neptune은 널리 사용되는 그래프 모델인 Property Graph 및 W3C의 RDF와 각각의 쿼리 언어를 지원하므로 고도로 연결된 데이터 세트를 효율적으로 탐색하는 쿼리를 쉽게 작성할 수 있습니다.

- Amazon DocumentDB (MongoDB 호환)는 MongoDB 워크로드를 지원하는 빠르고 확장 가능하며 가용성이 높으며 완전히 관리되는 문서 데이터베이스 서비스입니다.
마지막으로 Amazon EC2에서 독립적으로 실행되는 데이터 저장소를 멀티 계층 애플리케이션의 데이터 계층으로 사용할 수도 있습니다.


#### 프리젠테이션 계층

프리젠테이션 티어는 인터넷을 통해 노출 된 API Gateway REST 엔드 포인트를 통해 로직 티어와 상호 작용합니다.

- Amazon Cognito는 서버없는 사용자 자격 증명 및 데이터 동기화 서비스로, 웹 및 모바일 앱에 사용자 가입, 로그인 및 액세스 제어를 빠르고 쉽게 추가 할 수 있습니다. 

Amazon Cognito는 수백만 명의 사용자로 확장하고 Facebook, Google 및 Amazon과 같은 소셜 자격 증명 공급자 및 SAML 2.0을 통한 엔터프라이즈 자격 증명 공급자와의 로그인을 지원합니다.

- Amazon CloudFront가 포함 된 Amazon S3 : Amazon S3를 사용하면 웹 서버를 제공하지 않고도 S3 버킷에서 직접 단일 페이지 애플리케이션 (SPA)과 같은 정적 웹 사이트를 제공 할 수 있습니다. 

- Amazon CloudFront를 관리형 콘텐츠 전송 네트워크 (CDN)로 사용하여 성능을 향상시키고 관리 형 또는 사용자 지정 인증서를 사용하여 SSL / TL을 활성화 할 수 있습니다.


네트워킹 구성 및 애플리케이션 요구 사항에 따라 Amazon API Gateway API가 CORS (Cross-Origin Resource Sharing)와 호환되도록 해야 할 수 있습니다. 

CORS 준수는 웹 브라우저가 정적 웹 페이지 내에서 API를 직접 호출 할 수 있도록 합니다.

Amazon CloudFront가있는 웹 사이트를 배포하면 애플리케이션에 도달 할 수 있는 CloudFront 도메인 이름 (예 : d2d47p2vcczkh2.cloudfront.net)이 제공됩니다. 

Amazon Route 53을 사용하여 도메인 이름을 등록하여 CloudFront 배포로 보내거나 이미 소유 한 도메인 이름을 CloudFront 배포로 보낼 수 있습니다. 

이를 통해 사용자는 익숙한 도메인 이름을 사용하여 사이트에 액세스 할 수 있습니다.

Route 53을 사용하여 사용자 지정 도메인 이름을 API Gateway 배포에 할당하면 사용자가 익숙한 도메인 이름을 사용하여 API를 호출 할 수 있습니다.

![image](https://user-images.githubusercontent.com/62640332/156179992-88eb3141-7137-4600-b090-47eb11ee330d.png)

![image](https://user-images.githubusercontent.com/62640332/156180037-4ab65153-a180-41a9-bb38-3cac7ff334d5.png)

![image](https://user-images.githubusercontent.com/62640332/156180074-b3fc30a1-474b-46d0-970c-85888ae59044.png)

![image](https://user-images.githubusercontent.com/62640332/156180131-675e2ec8-1ac9-49f4-931d-f592499d9453.png)

![image](https://user-images.githubusercontent.com/62640332/156180185-327efc2d-310c-4f59-acdb-27c360a4d7fe.png)


#### 웹 서비스 계층 구성

![image](https://user-images.githubusercontent.com/62640332/156200175-16097c75-1154-4642-8abd-b7bb85e95891.png)


1. 코로케이션

데이터 센터,  사무실처럼 서버 또는 네트워크 장비를 배치하는 장소입니다. 최근에는 클라우드에 서버를 배치하고 있습니다. 

데이터 센터는 내진, 화재와 같은 여러 재해로부터 대책이 세워져 있고 보안 관리도 철저합니다. 

그리고 지리적인 위치도 중요하고요. 클라우드를 사용하게 되면 데이터 센터를 가지 않는 대신 

BCP(Business Continuity Planning : 기업이 자연재해나 테러와 같은 긴급 사태가 일어나도 사업을 중단하지 않거나 빠른 복구를 할 수 있는 계획)와 응답 시간에 우선순위를 둡니다. 

AWS 이용을 한다면 이전에는 도쿄 등의 리전을 사용하면서 응답시간을 고려했지만 2019년부터 서울 리전이 생긴만큼 지리적인 위치는 고려 대상이 아니겠네요. 


2. 네트워크

데이터 센터에서 제공하는 회선을 주로 사용합니다. 혹은 회사 내부에서 회선을 정하기도 하고요. 

최근에 프로젝트에서 점검하다 보니 비용 때문에 네트워크 속도 이슈도 있었습니다. 

시스템이 내부 사용이 주목적일 때는 저비용의 느린 네트워크를 사용해도 어떻게든 운영해갔는데 타 지역으로 인터페이스를 진행해야 되는 상황이 되면서 이슈가 생기더라고요.

클라우드 환경에서는 사업자가 제공하는 회선을 사용하면 되므로 고려 대상은 아니겠네요.


3. 하드웨어

네트워크 장비 

- 라우터 : 네트워크를 라우트(어떤 곳을 경유하는지 경로를 제어) 하는 것.

- 스위치 : 네트워크를 분배하는 것

  ☞L2 스위치 : 같은 세그먼트 내부의 것들을 연결하는 것.

      OSI 7 계층 중 계층 2인 데이터 링크 계층을 이해하고 처리 >> MAC 주소 기반으로 패킷 처리

  ☞L3 스위치 : 각각의 네트워크를 연결하는 것으로

      계층 3(네트워크 계층)을 이해하고 처리 >> IP 기반으로 패킷 처리 

- 물리 네트워크와 논리 네트워크 분리

물리 네트워크 장비의 물리적인 특성에서 따라오는 제약을 해결하기 위해 SDN이라는 방법이 나왔습니다.

소프트웨어에 의해 네트워크를 관리하는 것으로 요구가 있을 때 하드웨어를 설치하고 네트워크를 구축한다는 흐름을 바꿔놓았습니다.

클라우드를 떠올리면 좋겠네요.

- 서버 장비

x86 64비트 머신과 같이 어떤 머신을 사용할지? 어떤 CPU와 메모리를 넣을지? SSD를 사용할지 어떤 것을 사용할지 등의 결정이 필요합니다.

- 저장소

  - DAS : Direct-Attached Storage. 서버에 연결하는 거대한 디스크 배열입니다.

     단순하게 서버에 연결하는 거대한 하드 디스크라고 생각하면 될 듯합니다.

  - NAS : Network Attached Storage.

4. OS 선택

하드웨어와 애플리케이션의 중간 다리 역할. 오픈소스 VS 상용 OS로 구분되며, 리눅스와 윈도우 등이 있겠네요. 

대부분 리눅스를 사용하게 됩니다. 가장 큰 이유는 오픈소스로 무료라는 점이라고 합니다. 또한 GUI가 아니다 보니 접하기는 어렵지만 그게 리소스를 다른 곳에 사용할 수 있는 장점이라고도 하네요. 

리눅스 명령어가 익숙하지 않은 저는 아직 리눅스 다루기가 어렵습니다.... 하지만 콘솔 기반이다 보니 익숙해지면 자동화나 관리에 있어서 장점을 가진다고 하더라고요.


5. 미들웨어와 애플리케이션 실행 환경

OS와 애플리케이션 사이의 계층으로 이 2개의 계층을 나누기는 애매하다고 합니다. 

아파치나 톰캣부터 WAS, 유니티, 루비 등이 해당 계층에 속하네요. 

애플리케이션과 DB를 연결해주는 소프트웨어어도 DB 미들웨어이며 ODBC 등이 있을 것입니다. 

#### AWS VPC

ㅁ Region

리전(지역) 각 Amazon EC2 리전은 다른 Amazon EC2 리전에서 완전히 격리되도록 설계되었습니다. 이를 통해 가장 강력한 내결함성 및 안정성을 달성할 수 있습니다.

 리소스를 볼 때 해당 리전에 배치된 리소스만 표시됩니다.

이는 리전이 서로 격리되어 있기 때문이며, AWS는 각 리전 간에 자동으로 리소스를 복제하지 않습니다. 

인스턴스를 시작할 때 동일한 리전에 위치하고 있는 AMI를 선택해야 합니다. 

AMI가 다른 리전에 있는 경우는 해당 AMI를 사용할 리전으로 복사할 수 있습니다. 단, 리전 간 데이터 전송은 비용이 청구됩니다.

AWS에서 서비스를 이용하기 전에 가장 먼저 리전을 선택해야 합니다. 

리전의 선택 기준은 다음 3가지가 중요 요소입니다.

1. 지연 시간 최소화
2. 해당 리전에서 원하는 서비스 유무 확인
3. 비용(리전마다 다름)

ㅁ 가용 영역(AZ) 

가용 영역은 기본적으로 서로 격리되어 있지만, 한 리전의 가용 영역들은 낮은 수준의 지연 시간을 가진 링크를 통해 연결되어 있습니다.

인스턴스를 실행할 때 사용자가 직접 가용 영역을 선택하거나 AWS가 사용자를 위해 가용 영역을 선택하도록 할 수 있습니다. 

복수의 가용 영역에 걸쳐 인스턴스를 배포했을 때 하나의 인스턴스에 장애가 발생한 경우를 대비하여, 다른 가용 영역의 인스턴스가 장애가 발생한 인스턴스 관련 요청을 처리할 수 있도록 애플리케이션을 설계할 수 있습니다. 

또한 탄력적 IP 주소를 사용하여 한 가용 영역에서 인스턴스의 장애가 발생한 경우 다른 가용 영역의 인스턴스로 주소를 신속하게 매핑함으로써 인스턴스의 장애를 마스킹할 수 있습니다.

 
ㅁ VPC

사용자가 만든 가상 네트워크 , 하나의 리전에 생성되는 네트워크 대역(서울에는 4개의 데이터 센터가 있으니 이 4개를 논리적으로 묶음) 여기에서 각각의 네트워크대역을 만드는 것이 서브넷 