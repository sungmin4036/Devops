IaC란 Infrastructure as Code로 인프라를 코드로 정리하여 인프라를 관리하는 것을 말한다.


ㅁ Ansible

앤서블을 간단하게 설명하자면 SSH 와 파이썬을 이용하여 서버 혹은 컴퓨팅 장비를 설정할 수 있게 하는 자동화 도구이다. 

ㅁ 특징

1. Agentless

: 서블의 편한 점은 원격 호스트에 대해 관리자 권한을 가진 계정에 대해서 키 파일이 있으면 바로 접속을 할 수 있다는 점이다. 이는 바로 호스트 접속을 SSH 를 통해서 하기 때문이다. 

1. 최소화한 의존성

: 앤서블을 사용하기 위해서 별도의 추가 소프트웨어 설치가 필요하지 않다.

많은 서버 운영체제에서 SSH 및 파이썬은 기본적으로 지원되고 있고,

앤서블 또한 SSH 와 파이썬이 필요하기 때문에 앤서블을 설치하는 호스트 노드는 물론, 원격 호스트에도 추가 설치가 필요하지 않다.

앤서블은 서버로 많이 사용되는 리눅스 배포판들에서 기본적으로 패키지 저장소를 통해 제공되고 있기 때문에, 패키지 매니저를 통해 앤서블을 설치만 하면 사용할 준비가 거의 혹은 전부 다 되었다고 할 수 있다.

3. 푸시 기반

: 다른 자동화 도구들은 대개 필요한 작업이 있다면 일정한 시간 주기를 두고

에이전트에서 설정을 가져가 작업이 진행되길 기다리거나 

직접 원격 서버에 접속하여 수동으로 에이전트가 작동하여 작업이 진행되게 해야 한다.

필요할 경우 별도의 플러그인 등을 통해 푸시를 할 수 있다.


앤서블은 처음부터 푸시 기반으로 설계되었기 때문에 한 대의 서버에서 다른 원격 호스트들에 작업을 진행되게 명령을 내리는 형식이다.

따라서 한 곳에서 원하는 방식으로 작업 수행을 지정할 수 있다.

반대로 필요할 경우 풀(당겨오기) 방식으로 설정할 수 있다.

4. 강력한 보안

: 앤서블에서 원격 호스트를 접속할 때에는 SSH 를 사용한다.

 그렇기에 강력한 보안은 SSH 를 사용하여 얻는 장점이다. SSH 는 xNIX 서버라면 대부분 사용하게 되는 접속 방법이며,
 
 많은 사람들이 사용하고, 많은 보안 전문가들이 유심히 보고 있는 도구이기 때문에 자연스레 접속에 대한 보안성을 얻게 된다.

또한 에이전트가 없어서 추가적으로 포트를 열 필요도 없기 때문에 비교적 더 보안을 확보한다고 할 수 있다.

 

5. 간편한 조작과 설정
   
: 앤서블은 설계 원리에서부터 간편함을 추구하고 있기 때문에 앤서블을 통한 조작과 설정은 간편하고, 배우기도 쉽다.

 앤서블에서 사용하는 기본적인 모듈의 이름들은 대부분 xNIX 서버들에서 기존부터 사용해왔던 명령어들을 따르고 있어 명령어를 입력할 때에도 
 
  별도로 알아야 하는 점들이 많지 않으며, 앤서블에서 사용하는 일종의 스크립트라고 할 수 있는
  
   플레이북은 yaml 서식을 사용하여 비교적 간단하게 진행할 절차들을 쉽게 작성할 수 있다.

 

6. 안정된 지원

: 앤서블은 레드햇에서 인수한 회사명이기도 하다. 현재 앤서블은 레드햇에서 강력하게 지원은 물론, 홍보와 개발, 주 상품에 포함시키고 있는 주요한 소프트웨어이다. 

또한 오픈 소스이기 때문에 관련 사용자들과 커뮤니티에서 사용과 개발을 하고 있기 때문에 보다 빠른 패치와 업데이트가 진행되고 있으며, 사례들이 많다.

---

ㅁ Puppet

2005년에 출시했고 가장 오래된 IaC 도구 중 하나이다. 카탈로그를 통해 상태를 고치는 서버 / 클라이언트 기반이고 메타데이터 구성 방법인 hieradata를 사용한다.


ㅁ Terraform(테라폼)

1. 2014년에 출시했고 클라우드에 상관 없이 여러 클라우드 서비스들을 지원하기 때문에 다중 클라우드, 다중 환경을 관리할 수 있다. Hashicorp 언어를 사용하며 사용자 친화적이다.

2. 오케스트레이션 도구이다. 그렇기 때문에 원하는 상태에 있도록 계속 유지하려고 한다. 어떤 부분이 제대로 작동하지 않을 경우 자동으로 계산해서 리로드하려고 한다. 일정한 상태가 필요한 환경에 적합하다.

3. 선언적 언어이며, 사용자가 설명한 최종 상태에 도달하려고 노력한다.

4. 테라폼 프로비저닝 - 사용자 서버에 대한 액세스 권한 부여, 필수 외부 소프트웨어 설치, Terraform 자격 증명 등 추가 조치 필요



Terraform 과 ansible 둘은 비슷하지만 다른 목적으로 만들어 졌기 때문입니다.


Terrform은 orchestration tool이고 Ansible은 configuration management tool이지만 중복되는 몇몇 기능들이 있습니다. 하지만 그런 기능들은 제외되지않고 같이 사용할 수 있습니다.

저는 이 부분을  '음악가들의 오케스트레이션'에 비유해 설명 해보겠습니다. 여기서 terraform은 올바른 수의 악기들이 연주되고 소리가 올바르게 나는지 보장하는 지휘자입니다.

문제가 있을 경우 지휘자는 문제가 있는 악기를 교체합니다. 오케스트레이션 도구는 최종 결과에 중점을 두고 환경이 특정 상태로 유지되도록 할 수 있습니다. 따라서 Terraform은 환경을 정상인 상태로 유지시켜주는데 탁월한 기능을 제공합니다.


Ansible은 상황에 따라 다르게 동작하는 configuration management tool입니다. Ansible은 아까와 같은 상황(악기가 고장난)에서 악기를 교체하는 작업 대신 악기를 수리하기 위해 동작합니다. 물론 Ansible이 orchestration 작업을 수행할 수는 있지만 Terraform이 orchestration을 위해 더 advanced 하고 더 나은 옵션을 제공합니다.

---

ㅁ 절차적(Procedural) 아니면 선언적(Declarative)?
DevOps 도구로의 또 다른 관점의 분류로는 절차적(procedural)과 선언적(Declarative)로 볼 수 있습니다. 이러한 분류는 tool이 어떻게 동작하는지 설명합니다. 여기서 Terraform은 선언적 그룹에 속합니다. 이 부분이 의미하는 것은 만약 현재 정의된 환경이 변경되었다면 그것은 Terraform에 의해서 수정된 것입니다.

 

오케스트라의 비유로 돌아가서 설명하자면 Terraform은 더 많거나 적은 악기를 선언해야합니다. 따라서 만약 당신에게 5개의 악기가 있고 5개의 악기가 더 필요하다면 코드에 그것을 배치하면 됩니다. 더 적게 필요한 경우 코드에서 당신이 원하는 만큼 삭제하면 됩니다.

 

반면 Ansible은 하이브리드로 인식됩니다. Ansible은 절차적 스타일 구성이나 선언적으로 수행하는 모듈을 사용하여 두가지 스타일 모두 수행할 수 있습니다. 그래서 문서를 읽고 예상되는 동작을 이해하는 것이 매우 중요합니다.

 

즉, Terraform은 클라우드 인프라 구성에 적합하고 Ansible은 인프라 내의 서버 구성에 사용됩니다. Terraform에는 Ansible용 provisioning plugin이 없지만 많은 사람들이 Terraform으로 서버를 만들고 Ansible로 서버를 구성합니다. Terraform내에서 필요한 Ansible role들을 호출할 수도 있습니다.

 

그러나 stackshare.io의 통계를 살펴보면 Ansible은 stackoverflow의 12k이상의 점수를 기록하고 github의 41k의 star를 가진 Terraform보다 훨씬 인기가 많습니다.